# BLOCKHOUSE TASK

## Trade Order Backend Service

This project is a simple backend service built with **FastAPI** (Python) that exposes REST APIs for managing trade orders.  The application is containerized using **Docker**, deployed on an **AWS EC2 instance**, and integrated with a **CI/CD pipeline** using **GitHub Actions**.

---

### Features
- **REST APIs**:
  - `POST /orders`: Submit a new trade order.
  - `GET /orders`: Retrieve a list of submitted orders.
- **WebSocket Support**: Real-time updates for order status changes.
- **Database**: SQLite for development, PostgreSQL for production.
- **Containerization**: Docker for easy deployment.
- **Deployment**: Hosted on AWS EC2.
- **CI/CD**: Automated testing and deployment using GitHub Actions.

---

### Technologies Used
- **Backend**: FastAPI (Python)
- **Database**: SQLite (Development), PostgreSQL (Production)
- **Containerization**: Docker
- **Deployment**: AWS EC2
- **CI/CD**: GitHub Actions


---
### View Documetation of deployed service at:
[http://13.61.13.177/docs]

### Setup and Installation

#### Prerequisites
- Python 3.9+
- Docker
- AWS Account (for EC2 deployment)
- GitHub Account (for CI/CD)

#### Steps
1. **Clone the Repository**:
   ```bash
   git clone https://github.com/Jamesunekwuojo/tradeFlow
   cd tradeFlow
   ```

2. **Set Up a Virtual Environment**:
   ```bash
   python -m venv venv
   source venv/bin/activate
   ```

3. **Install Dependencies**:
   ```bash
   pip install -r requirements.txt
   ```

4. **Run the Application Locally**:
   ```bash
   uvicorn main:app --reload
   ```
   The application will be available at `http://localhost:8000`.

---

### Running the Application
#### Using Docker
1. **Build the Docker Image**:
   ```bash
   docker build -t trade-api .
   ```

2. **Run the Docker Container**:
   ```bash
   docker run -d -p 80:80 trade-api
   ```
   The application will be available at `http://localhost:80`.

---

### Deployment to AWS EC2

#### Step 1: Launch an EC2 Instance
- Go to the AWS Management Console.
- Launch an EC2 instance with:
  - **AMI**: Ubuntu Server 22.04 LTS
  - **Instance Type**: t2.micro (Free Tier eligible)
  - **Security Group**: Open ports 22 (SSH) and 80 (HTTP).

#### Step 2: SSH into the EC2 Instance
```bash
chmod 400 /path/to/your-key.pem
ssh -i /path/to/your-key.pem ubuntu@ec2-public-ip
```

#### Step 3: Install Docker on EC2
```bash
sudo apt update
sudo apt install docker.io
sudo systemctl start docker
sudo systemctl enable docker
```

#### Step 4: Deploy the Application
```bash
git clone https://github.com/your-username/trade-order-backend.git
cd trade-order-backend
sudo docker build -t trade-api .
sudo docker run -d -p 80:80 trade-api
```

---

### CI/CD Pipeline with GitHub Actions

#### Step 1: Set Up GitHub Actions
Create a `.github/workflows/deploy.yml` file in your repository:

```yaml
name: Deploy to EC2

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
      - name: Build Docker image
        run: docker build -t trade-api .
      - name: Deploy to EC2
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.EC2_HOST }}
          username: ubuntu
          key: ${{ secrets.EC2_SSH_KEY }}
          script: |
            docker stop trade-api || true
            docker rm trade-api || true
            docker run -d -p 80:80 --name trade-api trade-api
```

#### Add the following secrets to your GitHub repository:
- `EC2_HOST`: Public IP of your EC2 instance.
- `EC2_SSH_KEY`: Private key for SSH access.

---

### API Documentation
The API documentation is automatically generated by FastAPI and can be accessed at:
- **Swagger UI**: [http://localhost:8000/docs](http://localhost:8000/docs)
- **ReDoc**: [http://localhost:8000/redoc](http://localhost:8000/redoc)


---



### Troubleshooting
#### Application Not Accessible via Public IP
- **Check Security Group**: Ensure port 80 is open.
- **Check Firewall**: Allow port 80 on the EC2 instance.
- **Check Docker Binding**: Ensure the application binds to `0.0.0.0`.

#### Docker Container Fails to Start
Check the container logs:
```bash
sudo docker logs <container-id>
```

---

### Contributing
Contributions are welcome! Please open an issue or submit a pull request.

---


